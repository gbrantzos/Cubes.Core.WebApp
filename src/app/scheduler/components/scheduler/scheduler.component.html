<div *ngIf="data$ | async as data; else loading">

  <mat-card class="status" [class.status-started]="data.schedulerStatus.state==='Started'" [class.status-stopped]="data.schedulerStatus.state==='Stopped'">
    <p>
      Cubes scheduler is <strong>{{data.schedulerStatus.state}}</strong>.&nbsp;
      Current time on server is {{data.schedulerStatus.serverTime | date:'medium'}}.
    </p>
    <p style="margin-top: -6px;" *ngIf="unloadedModifications">Scheduler jobs are modified. <a href="" (click)="!!reload()">Reload</a> to apply!</p>
  </mat-card>

  <cubes-job-list
    [jobs]             = "data.schedulerStatus.jobs"
    [started]          = "data.schedulerStatus.state=='Started'"
    [lookups]          = "data.lookups"
    [autoReload]       = "autoReload"
    (modifyJob)        = "onJobModify($event)"
    (runJob)           = "onJobRun($event)"
    (schedulerControl) = "onSchedulerControl($event)">
  </cubes-job-list>

  <!-- Debug -->

  <pre class="code">{{data | json}}</pre>

</div>

<ng-template #loading>
  <cubes-loading
    (retry)        = "refreshList()"
    [hasErrors]    = "errorLoading"
    [errorMessage] = "errorMessage">
  </cubes-loading>
</ng-template>
